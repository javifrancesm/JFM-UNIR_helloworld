pipeline {
	agent any

	options { skipDefaultCheckout() }

	stages {

		stage('Get Code') {
			steps {
				git 'https://github.com/javifrancesm/JFM-UNIR_helloworld.git'
				echo WORKSPACE
				bat 'dir'
				stash name:'code', includes:'**'
				deleteDir()
			}
		}
			
				stage('Unit') {
					steps {
						catchError(buildResult: 'UNSTABLE', stageResult: 'FAILURE') {
							unstash name:'code'
							bat '''
								set PYTHONPATH=%WORKSPACE%
								pytest --junitxml=result-unit.xml test\\unit
							'''
							junit 'result-unit.xml'
							deleteDir()
						}
					}
				}

				stage('Static&Security') {
				parallel {

					stage('Static') {
						steps {
							catchError(buildResult: '', stageResult: '') {
								unstash name:'code'
								
								junit 'result-'
								deleteDir()
							}
						}
					}

					stage('Security') {
						steps {
							catchError(buildResult: '', stageResult: '') {
								unstash name:'code'

								junit 'result-'
								deleteDir()
							}
						}
					}
				}
				}

/* */

	}
}
